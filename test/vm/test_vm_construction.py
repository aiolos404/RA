import sys, os
from z3 import simplify
from utils import *
from vm import VM
from data_structures import WorldState
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))


world_state = WorldState()
# bytecode = '6001600201600a8257fe6200005660138457fe00' #jump dest is symbol var
# bytecode = '45600557fe44600a57fe4300'
bytecode = '6060604052341561000f57600080fd5b610017610080565b604051809103906000f080151561002d57600080fd5b600080600a8110151561003c57fe5b0160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610090565b604051610161806101e683390190565b6101478061009f6000396000f300606060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632e1a7d4d14610046575b600080fd5b341561005157600080fd5b6100676004808035906020019091905050610069565b005b600065abcdabcdabcd9050600082600a8110151561008357fe5b0160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401600060405180830381600087803b151561010757600080fd5b5af1151561011457600080fd5b50505050505600a165627a7a72305820eecdd555e7c6a2b6b93821804ec8dff09eb7920b795d121855e5106105b0911d00296060604052341561000f57600080fd5b6101438061001e6000396000f300606060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633ccfd60b14610046575b600080fd5b341561005157600080fd5b61005961005b565b005b3373ffffffffffffffffffffffffffffffffffffffff166000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205460405180602001905060006040518083038185875af192505050156101155760008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505b5600a165627a7a72305820e598d1a576b5047521cba20260ee9579fee29311bfbb5623191a49ca74a1e4380029'
# mul
# bytecode = '600360100200'
# SUB
# bytecode = '600a60030300'
# DIV
# bytecode = '600960000400'
#bytecode = '0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01600055'
#bytecode = '601060000600'
#SDIV
#bytecode = '30300700'

primary_contracts = [bytecode]
secondary_contract = None
tertiary_contracts = []


vm = VM(world_state)
for b in primary_contracts:
    vm.add_primary_contract(b)
vm.run_all()
# vm.show_vm_state()




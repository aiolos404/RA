# プログラム開始時のブロック
1. code_stackに実行対象となるバイトコードを全てpush
1. code_stackが空になるまで以下を繰り返す
    1. code_stackからバイトコードを1つpop
    1. それを元に新しいexecution_environmentを作成
    1. 空のmachine_stateを作成
    1. 実行開始
    1. 途中でCREATEがあれば新しいバイトコードをcode_stackにpush(初期化コードはそのまま各状態を作成して実行)

# 分岐におけるBasicBlockの扱い


## 分岐しないとき & 分岐ある場合に続行する(ジャンプしない)とき
1. 現在の状態でBasicBlock構成しCFGmanagerに保存
1. machine_stateに新しいpcの値をセット
1. 実行

## 分岐するとき(ジャンプするとき)
### ジャンプ先となるブロックの作成とプッシュ
深さ優先探索のため、あとでロールバックして実行する
1. 現在の状態でBasicBlockを構成
1. 構成したブロックのmachine_stateにジャンプ先のpcの値をセット
1. dfs_stackに構成したBasicBlockをpush

### 分岐へのロールバック時
1. 現在の状態でBasicBlockを構成しCFGmanagerに保存
1. dfs_stackからpopしたBasicBlockから状態を復元
1. 実行

# createによって新たなコントラクトが生成される場合

# createの初期化コード実行時やcallにおいて外部ジャンプする際のBasicBlockの扱い
## 外部ジャンプするとき
### 戻り先となるブロックの作成とプッシュ
1. 現在の状態でBasicBlockを構成しCFGmanagerに保存
1. machine_stateに戻り先となるpc(=現在の次の命令)をセット
1. 現在の状態でBasicBlockを再構成,return_destとして維持

### 外部コードのブロックの作成
1. 新しいexecutioin_environmentを作成してセット
1. storage,returndataを空にする
1. return_destをprocessing_blockにセット
1. 実行

## 外部から戻るとき
1. 現在のBasicBlockをCFGmanagerに保存
1. call_stackからpopしたブロックに現在のmachine_stateのstack, memory(, returndata)をdeepcopyしてセット
1. ブロックを実行


# delegatecallにおいて外部ジャンプする際のBasicBlockの扱い
## 外部ジャンプするとき
### 戻り先となるブロックの作成とプッシュ
上に同じ
### 外部コードのブロックの作成
1. 新しいブロックを作成
1. 新しいexecutioin_environmentを作成して新しいブロックにセット
1. 現在のmachine_stateのstorage, memory, stack(, returndata)をdeepcopyして新しいブロックにセット
1. 新しいブロックを実行

## 外部から戻るとき
1. 現在のBasicBlockをCFGmanagerに保存
1. call_stackからpopしたブロックに現在のmachine_stateのstorage, stack, memory(, returndata)をdeepcopyしてセット
1. ブロックを実行

# BasicBlockの複製について
mnemonisは空  
machine_stateはmutableなのでdeepcopy  
execution_environmentはimmutableなので参照を代入するだけ(shallowcopyでもない)
